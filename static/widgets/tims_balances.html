<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="mobile-web-app-capable" content="yes">
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org" />
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Tims Widget</title>
  <script type="text/javascript" src=
  "https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.min.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity=
  "sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous" type=
  "text/javascript">
</script>
    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWjx3YmGY-11XnmruA4LIE0NFDTkb2umE">
    </script>
  <script type="text/javascript">
//<![CDATA[
      function runFreeFormQuery(query, cb) {
          $.get('/api/run_query/freeform/?query='+query, function(data) {
             cb(data); 
          });
      }
      var beep = new  Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");
  $(function() {
      function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(processPosition);
            } else {
                
            }
        }
        function processPosition(position) {
            console.log(position.coords.latitude, position.coords.longitude, position.coords.accuracy, position.coords.altitude, position.coords.altitudeAccuracy, position.coords.heading, position.coords.speed);
            window.lastPosition = position;
        }
      getLocation();
      const app = new Vue({
          el: '#app',
          data: {
              balances: [],
              ebt_balances: [],
              to_work: '',
              to_home: '',
              page: 'home',
          },
          methods: {
              loadData: function(table) {
                  $.get('https://devapi.wayeasycorp.com/api/run_query/template?name=tims_balances', function(data) {
                      var balances = [];
                      pluckedData = _.pluck(data.results, 'balances');
                      $.each(pluckedData, function(i, v) {
                          $.each(v, function(j, u) {
                              balances.push(u);
                          });
                      });
                      app.balances = Object.assign([], app.balances, balances);
                  });
                  $.get('https://devapi.wayeasycorp.com/api/run_query/template?name=tims_ebt_balances', function(data) {
                      balances = data['results'][0]['balances'];
                      balances = [{'name': 'EBT CASH', 'amount': balances['EBT CASH']}, {'name': 'EBT SNAP', 'amount': balances['EBT SNAP']}];
                      app.ebt_balances = Object.assign([], app.ebt_balances, balances);
                  });
              },
              need_police: function() {
                  beep.play();
                  app.page = 'need_police';
              },
              emergency_not_safe_to_use_app: function() {
                  beep.play();
                  var gps = {'latitude': lastPosition.coords.latitude, 'longitude': lastPosition.coords.longitude, 'accuracy': lastPosition.coords.accuracy, 'altitude': lastPosition.coords.altitude, 'altitudeAccuracy': lastPosition.coords.altitudeAccuracy, 'heading': lastPosition.coords.heading, 'speed': lastPosition.coords.speed};
                  data = {'about_user': 1, 'type': 'emergency_report','locations': [gps], 'known places': [{'type': 'work', 'address': '999 3rd ave', 'unit #': 'suite 700 east window 2nd set of cubiles from north window'}], 'is_active': true}
                  $.post('/api/insert_object', {'data': JSON.stringify(data)}, function(data) {console.log(JSON.stringify(data))});
                  app.page = 'home';
              },
              emergency: function() {
                  app.page = 'emergency';
              },
              not_emergency: function() {
                  app.page = 'not_emergency';
              },
              cancel: function() {
                  app.page = 'home';
              },
              stress: function() {
                  var msg = new SpeechSynthesisUtterance('Everythings going to be alright. Take three deep breaths. Talk in a normal voice. Use assertive language.');
                  window.speechSynthesis.speak(msg);
              }
          },
          created() {
              this.loadData();
              var home = '14431 58th ave s, tukwila';
              var work = '999 3rd ave, seattle';
              var directionsService = new google.maps.DirectionsService;
                var directionsDisplay = new google.maps.DirectionsRenderer;
              directionsService.route({
                  origin: home,
                  destination: work,
                  travelMode: 'TRANSIT'
                }, function(response, status) {
                  if (status === 'OK') {
                    app.to_work = response['routes'][0]['legs'][0]['departure_time']['text'];
                  } else {
                    window.alert('Directions request failed due to ' + status);
                  }
                });
              directionsService.route({
                  origin: work,
                  destination: home,
                  travelMode: 'TRANSIT'
                }, function(response, status) {
                  if (status === 'OK') {
                    app.to_home = response['routes'][0]['legs'][0]['departure_time']['text'];
                      console.log(response);
                      console.log(response['routes'][0]['legs'][0]['departure_time']['text'])
                  } else {
                    window.alert('Directions request failed due to ' + status);
                  }
                });
              setInterval(function () {
                  this.loadData();
                }.bind(this), 30000); 
          }
      })

  });
  //]]>
  </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" />
  <style type="text/css">
/*<![CDATA[*/
body {
    font-size:2em;
    color:#FFF;
    margin:5px;
    background:#000;
    font-family:sans-serif;
      }
      table {
          border-collapse:collapse;
      }
      th, td {
              padding:5px;
              border:1px solid #FFF;
          }
      textarea {
          width:100%;
          height:50px;
      }
      li.selected {
          background:yellow;
      }
      .taglist {
  display: inline;
  list-style: none;
}

.taglist li {
  display: inline;
}
  
.taglist li:after {
  content: ", ";
}
      .taglist li:last-child:after {
    content: "";
}
      .key_buttons {position:fixed;bottom:0;left:0;width:100%;}
      #need_police {font-size:2.5em; height:120px;background:red;color:#FFF; width:100%;}
      #stress {font-size:2em; background:orange;color:#FFF;width:100%}
      h2 {
          font-size:2em;
      }
      .button {width:100%;font-size:2em;color:#FFF;}
      .emergency_not_safe_to_use_app {font-size:1.5em;background:red;}
      .yes {background:orange;}
      .no {background:blue;}
      .cancel {background:gray;}
  /*]]>*/
  </style>
</head>

<body>
    <div id="app">
        <div v-if="page == 'home'">
            <div class="key_buttons">
                <button id="stress" v-on:click="stress">Stress</button>
            <button id="need_police" v-on:click="need_police"></button>
            
            </div>
            <table>
                <tr v-for="account in balances">
                    <td>{{ account.meta.name + ' ' + account.meta.number }}</td>
                    <td>${{ account.balance.available }}</td>
                </tr>
                <tr v-for="account in ebt_balances">
                    <td>{{ account.name }}</td>
                    <td>${{ account.amount }}</td>
                </tr>
                <tr>
                    <th>To work</th><td>{{ to_work }}</td>
                </tr>
                <tr>
                    <th>To home</th><td>{{ to_home }}</td>
                </tr>
            </table>
        </div>
        <div v-if="page == 'need_police'">
            <div class="key_buttons">
            <button class="button emergency_not_safe_to_use_app"  v-on:click="emergency_not_safe_to_use_app">EMERGENCY! Unsafe to use app</button>
            </div>
            <h2>Is this an emergency?</h2>
            <button class="button yes"  v-on:click="emergency">Yes</button>
            <button class="button no"  v-on:click="not_emergency">No</button>
            <button class="button cancel"  v-on:click="cancel">Cancel</button>
        </div>
    </div>
    
    
</body>
</html>
